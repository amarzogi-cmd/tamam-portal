# بوابة تمام للعناية بالمساجد - قائمة المهام

## المرحلة 1: قاعدة البيانات والجداول الأساسية
- [x] إنشاء جدول المستخدمين مع الأدوار التسعة
- [x] إنشاء جدول الموظفين مع البيانات التفصيلية
- [x] إنشاء جدول المساجد مع جميع الحقول
- [x] إنشاء جدول الطلبات الرئيسي (mosque_requests)
- [x] إنشاء جدول مرفقات الطلبات (request_attachments)
- [x] إنشاء جدول تعليقات الطلبات (request_comments)
- [x] إنشاء جدول سجل الطلبات (request_history)
- [x] إنشاء جدول تقارير الزيارات الميدانية
- [x] إنشاء جدول تقارير الاستجابة السريعة
- [x] إنشاء جدول التقارير الختامية
- [x] إنشاء جدول المشاريع
- [x] إنشاء جدول مراحل المشاريع
- [x] إنشاء جدول العقود
- [x] إنشاء جدول الدفعات المالية
- [x] إنشاء جدول فرص التبرع
- [x] إنشاء جدول الموردين والمقاولين
- [x] إنشاء جدول عروض الأسعار
- [x] إنشاء جدول جداول الكميات
- [x] إنشاء جدول الإشعارات
- [x] إنشاء جدول التصنيفات
- [x] إنشاء جدول إعدادات الهوية البصرية
- [x] إنشاء جدول سجل التدقيق (audit_logs)
- [x] إنشاء جدول الشركاء والداعمين
- [x] تشغيل db:push لتطبيق التغييرات

## المرحلة 2: نظام المصادقة والأدوار
- [x] تعريف الأدوار التسعة في النظام
- [x] إنشاء نظام تسجيل طالبي الخدمة
- [x] إنشاء نظام دخول الموظفين
- [x] إنشاء صفحة اعتماد المستخدمين الجدد
- [x] تطبيق صلاحيات كل دور
- [x] إنشاء middleware للتحقق من الصلاحيات

## المرحلة 3: نظام إدارة المساجد
- [x] إنشاء نموذج تسجيل مسجد جديد
- [ ] تكامل خرائط Google لتحديد الموقع
- [x] إنشاء قائمة المساجد مع الفلاتر
- [x] إنشاء صفحة تفاصيل المسجد
- [x] نظام اعتماد المساجد الجديدة
- [ ] عرض المساجد على الخريطة

## المرحلة 4: نماذج البرامج التسعة
- [x] نموذج برنامج بنيان (بناء مسجد جديد)
- [x] نموذج برنامج دعائم (استكمال المساجد المتعثرة)
- [x] نموذج برنامج عناية (الصيانة والترميم)
- [x] نموذج برنامج إمداد (توفير التجهيزات)
- [x] نموذج برنامج إثراء (سداد الفواتير)
- [x] نموذج برنامج سدانة (خدمات النظافة)
- [x] نموذج برنامج طاقة (الطاقة الشمسية)
- [x] نموذج برنامج مياه (أنظمة المياه)
- [x] نموذج برنامج سقيا (توفير ماء الشرب)

## المرحلة 5: نظام تتبع الطلبات
- [x] تطبيق المراحل السبع للطلبات
- [x] مرحلة 1: تقديم الطلب
- [x] مرحلة 2: المراجعة الأولية
- [x] مرحلة 3: الزيارة الميدانية
- [x] مرحلة 4: التقييم الفني
- [x] مرحلة 5: التقييم المالي
- [x] مرحلة 6: التنفيذ
- [x] مرحلة 7: الإغلاق
- [x] نظام تحديث حالة الطلب
- [x] سجل تاريخ الطلب

## المرحلة 6: الإشعارات والتقارير ولوحة التحكم
- [ ] نظام الإشعارات الداخلية
- [ ] إشعارات البريد الإلكتروني
- [ ] لوحة تحكم المدير العام
- [ ] لوحة تحكم مكتب المشاريع
- [ ] لوحة تحكم الفريق الميداني
- [ ] لوحة تحكم طالب الخدمة
- [ ] تقارير الطلبات
- [ ] تقارير المساجد
- [ ] تقارير المستخدمين
- [ ] تقارير مالية
- [ ] رسوم بيانية وإحصائيات

## المرحلة 7: إدارة المشاريع والتبرعات
- [ ] إنشاء مشروع من طلب معتمد
- [ ] إدارة مراحل المشروع
- [ ] جداول الكميات
- [ ] عروض الأسعار
- [ ] العقود
- [ ] الدفعات المالية
- [ ] فرص التبرع
- [ ] ربط المتبرعين بالمشاريع

## المرحلة 8: واجهات المستخدم
- [x] الصفحة الرئيسية العامة
- [x] صفحة تسجيل الدخول
- [x] صفحة التسجيل لطالبي الخدمة
- [x] لوحة تحكم المدير العام
- [x] لوحة تحكم مدير النظام
- [x] لوحة تحكم مكتب المشاريع
- [x] لوحة تحكم الفريق الميداني
- [x] لوحة تحكم فريق الاستجابة السريعة
- [x] لوحة تحكم الإدارة المالية
- [x] لوحة تحكم مدير المشروع
- [x] لوحة تحكم الاتصال المؤسسي
- [x] لوحة تحكم طالب الخدمة

## المرحلة 9: الهوية البصرية ومركز الشركاء
- [ ] إعدادات الهوية البصرية
- [ ] إدارة الشعارات
- [ ] إدارة الألوان
- [ ] مركز الشركاء والداعمين
- [ ] عرض الشركاء في الصفحة الرئيسية

## المرحلة 10: الاختبار
- [x] اختبارات الوحدات (Vitest)
- [x] اختبار رحلة طالب الخدمة الكاملة
- [x] اختبار رحلة الموظف
- [x] اختبار نظام الصلاحيات
- [ ] اختبار نظام الإشعارات

## المرحلة 11: النشر والتسليم
- [x] حفظ نقطة checkpoint
- [x] توثيق النظام
- [x] تسليم المشروع للمستخدم

## المرحلة 12: تحسينات إضافية

### تكامل خرائط Google الكامل
- [x] إنشاء مكون خريطة لعرض المساجد
- [x] إضافة خريطة تفاعلية في صفحة المساجد
- [x] إضافة اختيار الموقع على الخريطة في نموذج تسجيل المسجد
- [x] عرض تفاصيل المسجد على الخريطة مع نافذة معلومات
### نظام الإشعارات
- [x] إنشاء router للإشعارات
- [x] إرسال إشعار عند تقديم طلب جديد
- [x] إرسال إشعار عند تغيير حالة الطلب
- [x] إرسال إشعار عند إضافة تعليق
- [x] إرسال إشعار عند جدولة زيارة ميدانية
- [x] صفحة عرض### البيانات التجريبية
- [x] إنشاء script لإضافة بيانات تجريبية
- [x] إضافة 10 مساجد تجريبية مع إحداثيات حقيقية
- [x] إضافة 5 شركاء تجريبيين
- [x] إضافة إعدادات الهوية البصرية
- [x] إضافة 18 مدينة في منطقة عسير
## المرحلة 13: إعداد حساب المدير
- [x] إنشاء حساب مدير النظام الافتراضي
- [x] إصلاح نظام التحقق من كلمة المرور عند تسجيل الدخول
- [x] إضافة خيار الدخول عبر Manus OAuth في صفحة تسجيل الدخول
- [x] تطبيق خط Cairo بجميع أوزانه على التصميم

## المرحلة 14: تحسين نموذج الطلبات
- [x] إنشاء نموذج طلب واحد ديناميكي (طلبات المساجد) بدلاً من 9 نماذج منفصلة
- [x] تحديث الصفحة الرئيسية لعرض "خدمات المساجد" مع زر واحد "تقدم بطلبك الآن"
- [x] تطبيق الحقول المشتركة والحقول الخاصة بكل برنامج حسب جدول نماذج الإدخال
- [ ] إضافة التنبيهات والشروط والأحكام في النموذج
- [ ] جعل بيانات مقدم الطلب تظهر تلقائياً من بيانات التسجيل


## إصلاح الأخطاء
- [x] إصلاح رسالة "المسجد غير موجود" عند تقديم طلب بنيان (لا يتطلب مسجد)
- [x] إصلاح خطأ 404 عند التوجيه بعد إرسال الطلب (/requester/requests/1)


## المرحلة 15: رفع المرفقات ولوحة طالب الخدمة وإدارة المشاريع

### رفع المرفقات
- [x] إنشاء API لرفع الملفات إلى S3
- [x] إضافة مكون رفع الملفات في نموذج الطلب
- [x] دعم رفع صور الموقع
- [x] دعم رفع صكوك الأرض والمستندات
- [x] عرض المرفقات في صفحة تفاصيل الطلب
- [x] إمكانية تحميل المرفقات

### لوحة تحكم طالب الخدمة
- [x] صفحة متابعة الطلبات الخاصة بالمستخدم
- [x] عرض حالة كل طلب مع المرحلة الحالية
- [ ] إشعارات التحديثات على الطلبات
- [ ] إمكانية إضافة تعليقات على الطلب
- [ ] عرض سجل الطلب الكامل

### نظا### نظام إدارة المشاريع
- [x] إنشاء مشروع من طلب معتمد
- [x] إدارة جداول الكميات (BOQ)
- [x] إدارة عروض الأسعار
- [x] إدارة العقود
- [x] إدارة الدفعات المالية
- [x] متابعة مراحل المشروعبط فرص التبرع بالمشاريع


## المرحلة 16: نظام العقود المتكامل

### إعدادات الجمعية (البيانات الثابتة)
- [x] جدول إعدادات الجمعية في قاعدة البيانات
- [x] صفحة إعدادات الجمعية (اسم الجمعية، رقم الترخيص، العنوان، مفوض التوقيع)
- [x] حفظ بيانات الطرف الأول (الجمعية) الثابتة

### نموذج العقد
- [x] جدول العقود في قاعدة البيانات
- [x] ترقيم آلي للعقود
- [x] نموذج إنشاء عقد جديد مع المتغيرات
- [x] أنواع العقود (إشراف هندسي، مقاولات، توريد)
- [x] جدول الدفعات المرتبط بالعقد

### معاينة وطباعة العقد
- [x] صفحة معاينة العقد قبل الطباعة
- [x] تصميم العقد بتنسيق احترافي
- [x] إمكانية طباعة العقد أو تصديره PDF

### تحويل العقد إلى مشروع
- [x] خاصية تحويل العقد المعتمد إلى مشروع
- [x] ربط العقد بالمشروع والطلب


## المرحلة 17: نظام الموردين المعتمدين

### قاعدة بيانات الموردين
- [x] تحديث جدول الموردين بالحقول الجديدة (معلومات الكيان، التواصل، البنك، المرفقات)
- [x] إضافة جدول مجالات العمل للموردين
- [x] إضافة جدول مرفقات الموردين

### نموذج تسجيل الموردين
- [x] الخطوة 1: معلومات الكيان (الاسم، النوع، السجل، النشاط، الخبرة، المجالات)
- [x] الخطوة 2: معلومات التواصل (العنوان، الموقع، البريد، الهاتف، مسؤول التواصل)
- [x] الخطوة 3: معلومات الحساب البنكي (اسم الحساب، البنك، الآيبان، الرقم الضريبي)
- [x] الخطوة 4: المرفقات (السجل التجاري، شهادة الضريبة، العنوان الوطني)

### إدارة واعتماد الموردين
- [x] صفحة قائمة الموردين مع التصفية والبحث
- [x] صفحة تفاصيل المورد
- [x] خاصية اعتماد/رفض المورد
- [x] عرض المرفقات والتحقق منها

### تكامل العقود مع الموردين
- [x] اختيار المورد المعتمد عند إنشاء العقد
- [x] تعبئة بيانات الطرف الثاني تلقائياً من بيانات المورد


## المرحلة 18: إكمال رحلة الطلب

### تحسين نموذج طلب الخدمة
- [ ] جعل بيانات مقدم الطلب تظهر تلقائياً من بيانات التسجيل (غير قابلة للتعديل)
- [ ] إضافة التنبيهات والشروط والأحكام في بداية النموذج
- [ ] تحسين عرض البيانات في صفحة المراجعة

### نموذج المعاينة الميدانية

- [x] إنشاء نموذج المعاينة الميدانية الجديد
- [x] استيراد بيانات الطلب والمسجد تلقائياً
- [x] حقول التقييم الفني (حالة المسجد، المساحات)
- [x] حقول مصلى الرجال (الطول، العرض، الارتفاع)
- [x] حقول مصلى النساء (الطول، العرض، الارتفاع)
- [x] حقل الاحتياج والوصف العام
- [x] رفع صور المعاينة (متعددة)
- [x] حقول فريق المعاينة (5 أعضاء)
### تقرير الاستجابة السريعة
- [x] إنشاء تقرير الاستجابة السريعة الجديد
- [x] استيراد بيانات الطلب والمسجد تلقائياً
- [x] حقول التقييم الفني والنهائي
- [x] حقل الأعمال غير المنفذة وأسباب عدم التنفيذ
- [x] رفع صور التوثيق (حتى 10 صور)
- [x] حقل الفني المختص

### ربط المراحل بالنماذج
- [x] ربط مرحلة الزيارة الميدانية بنموذج المعاينة
- [x] ربط مرحلة الاستجابة السريعة بتقرير الاستجابة
- [x] تحديث صفحة تفاصيل الطلب لعرض التقارير المرتبطة


## المرحلة 19: توحيد أسماء المراحل وإصلاح رحلة الطلب

### توحيد أسماء المراحل
- [x] توحيد أسماء المراحل بين Frontend و Backend
- [x] تحديث STAGE_LABELS في shared/constants.ts
- [x] تحديث stageSteps في RequestDetails.tsx
- [x] تحديث stageSteps في MyRequests.tsx
- [x] المراحل الموحدة: submitted, initial_review, field_visit, technical_eval, financial_eval, execution, closed

### اختبار رحلة الطلب
- [x] اختبار تحويل الطلب من مرحلة تقديم الطلب إلى الفرز الأولي
- [x] اختبار تحويل الطلب من مرحلة الفرز الأولي إلى الزيارة الميدانية
- [x] التأكد من عمل شريط المراحل بشكل صحيح
- [x] التأكد من تسجيل التحديثات في سجل الطلب
