# بوابة تمام للعناية بالمساجد - قائمة المهام

## المرحلة 1: قاعدة البيانات والجداول الأساسية
- [x] إنشاء جدول المستخدمين مع الأدوار التسعة
- [x] إنشاء جدول الموظفين مع البيانات التفصيلية
- [x] إنشاء جدول المساجد مع جميع الحقول
- [x] إنشاء جدول الطلبات الرئيسي (mosque_requests)
- [x] إنشاء جدول مرفقات الطلبات (request_attachments)
- [x] إنشاء جدول تعليقات الطلبات (request_comments)
- [x] إنشاء جدول سجل الطلبات (request_history)
- [x] إنشاء جدول تقارير الزيارات الميدانية
- [x] إنشاء جدول تقارير الاستجابة السريعة
- [x] إنشاء جدول التقارير الختامية
- [x] إنشاء جدول المشاريع
- [x] إنشاء جدول مراحل المشاريع
- [x] إنشاء جدول العقود
- [x] إنشاء جدول الدفعات المالية
- [x] إنشاء جدول فرص التبرع
- [x] إنشاء جدول الموردين والمقاولين
- [x] إنشاء جدول عروض الأسعار
- [x] إنشاء جدول جداول الكميات
- [x] إنشاء جدول الإشعارات
- [x] إنشاء جدول التصنيفات
- [x] إنشاء جدول إعدادات الهوية البصرية
- [x] إنشاء جدول سجل التدقيق (audit_logs)
- [x] إنشاء جدول الشركاء والداعمين
- [x] تشغيل db:push لتطبيق التغييرات

## المرحلة 2: نظام المصادقة والأدوار
- [x] تعريف الأدوار التسعة في النظام
- [x] إنشاء نظام تسجيل طالبي الخدمة
- [x] إنشاء نظام دخول الموظفين
- [x] إنشاء صفحة اعتماد المستخدمين الجدد
- [x] تطبيق صلاحيات كل دور
- [x] إنشاء middleware للتحقق من الصلاحيات

## المرحلة 3: نظام إدارة المساجد
- [x] إنشاء نموذج تسجيل مسجد جديد
- [ ] تكامل خرائط Google لتحديد الموقع
- [x] إنشاء قائمة المساجد مع الفلاتر
- [x] إنشاء صفحة تفاصيل المسجد
- [x] نظام اعتماد المساجد الجديدة
- [ ] عرض المساجد على الخريطة

## المرحلة 4: نماذج البرامج التسعة
- [x] نموذج برنامج بنيان (بناء مسجد جديد)
- [x] نموذج برنامج دعائم (استكمال المساجد المتعثرة)
- [x] نموذج برنامج عناية (الصيانة والترميم)
- [x] نموذج برنامج إمداد (توفير التجهيزات)
- [x] نموذج برنامج إثراء (سداد الفواتير)
- [x] نموذج برنامج سدانة (خدمات النظافة)
- [x] نموذج برنامج طاقة (الطاقة الشمسية)
- [x] نموذج برنامج مياه (أنظمة المياه)
- [x] نموذج برنامج سقيا (توفير ماء الشرب)

## المرحلة 5: نظام تتبع الطلبات
- [x] تطبيق المراحل السبع للطلبات
- [x] مرحلة 1: تقديم الطلب
- [x] مرحلة 2: المراجعة الأولية
- [x] مرحلة 3: الزيارة الميدانية
- [x] مرحلة 4: التقييم الفني
- [x] مرحلة 5: التقييم المالي
- [x] مرحلة 6: التنفيذ
- [x] مرحلة 7: الإغلاق
- [x] نظام تحديث حالة الطلب
- [x] سجل تاريخ الطلب

## المرحلة 6: الإشعارات والتقارير ولوحة التحكم
- [ ] نظام الإشعارات الداخلية
- [ ] إشعارات البريد الإلكتروني
- [ ] لوحة تحكم المدير العام
- [ ] لوحة تحكم مكتب المشاريع
- [ ] لوحة تحكم الفريق الميداني
- [ ] لوحة تحكم طالب الخدمة
- [ ] تقارير الطلبات
- [ ] تقارير المساجد
- [ ] تقارير المستخدمين
- [ ] تقارير مالية
- [ ] رسوم بيانية وإحصائيات

## المرحلة 7: إدارة المشاريع والتبرعات
- [ ] إنشاء مشروع من طلب معتمد
- [ ] إدارة مراحل المشروع
- [ ] جداول الكميات
- [ ] عروض الأسعار
- [ ] العقود
- [ ] الدفعات المالية
- [ ] فرص التبرع
- [ ] ربط المتبرعين بالمشاريع

## المرحلة 8: واجهات المستخدم
- [x] الصفحة الرئيسية العامة
- [x] صفحة تسجيل الدخول
- [x] صفحة التسجيل لطالبي الخدمة
- [x] لوحة تحكم المدير العام
- [x] لوحة تحكم مدير النظام
- [x] لوحة تحكم مكتب المشاريع
- [x] لوحة تحكم الفريق الميداني
- [x] لوحة تحكم فريق الاستجابة السريعة
- [x] لوحة تحكم الإدارة المالية
- [x] لوحة تحكم مدير المشروع
- [x] لوحة تحكم الاتصال المؤسسي
- [x] لوحة تحكم طالب الخدمة

## المرحلة 9: الهوية البصرية ومركز الشركاء
- [ ] إعدادات الهوية البصرية
- [ ] إدارة الشعارات
- [ ] إدارة الألوان
- [ ] مركز الشركاء والداعمين
- [ ] عرض الشركاء في الصفحة الرئيسية

## المرحلة 10: الاختبار
- [x] اختبارات الوحدات (Vitest)
- [x] اختبار رحلة طالب الخدمة الكاملة
- [x] اختبار رحلة الموظف
- [x] اختبار نظام الصلاحيات
- [ ] اختبار نظام الإشعارات

## المرحلة 11: النشر والتسليم
- [x] حفظ نقطة checkpoint
- [x] توثيق النظام
- [x] تسليم المشروع للمستخدم

## المرحلة 12: تحسينات إضافية

### تكامل خرائط Google الكامل
- [x] إنشاء مكون خريطة لعرض المساجد
- [x] إضافة خريطة تفاعلية في صفحة المساجد
- [x] إضافة اختيار الموقع على الخريطة في نموذج تسجيل المسجد
- [x] عرض تفاصيل المسجد على الخريطة مع نافذة معلومات
### نظام الإشعارات
- [x] إنشاء router للإشعارات
- [x] إرسال إشعار عند تقديم طلب جديد
- [x] إرسال إشعار عند تغيير حالة الطلب
- [x] إرسال إشعار عند إضافة تعليق
- [x] إرسال إشعار عند جدولة زيارة ميدانية
- [x] صفحة عرض### البيانات التجريبية
- [x] إنشاء script لإضافة بيانات تجريبية
- [x] إضافة 10 مساجد تجريبية مع إحداثيات حقيقية
- [x] إضافة 5 شركاء تجريبيين
- [x] إضافة إعدادات الهوية البصرية
- [x] إضافة 18 مدينة في منطقة عسير
## المرحلة 13: إعداد حساب المدير
- [x] إنشاء حساب مدير النظام الافتراضي
- [x] إصلاح نظام التحقق من كلمة المرور عند تسجيل الدخول
- [x] إضافة خيار الدخول عبر Manus OAuth في صفحة تسجيل الدخول
- [x] تطبيق خط Cairo بجميع أوزانه على التصميم

## المرحلة 14: تحسين نموذج الطلبات
- [x] إنشاء نموذج طلب واحد ديناميكي (طلبات المساجد) بدلاً من 9 نماذج منفصلة
- [x] تحديث الصفحة الرئيسية لعرض "خدمات المساجد" مع زر واحد "تقدم بطلبك الآن"
- [x] تطبيق الحقول المشتركة والحقول الخاصة بكل برنامج حسب جدول نماذج الإدخال
- [ ] إضافة التنبيهات والشروط والأحكام في النموذج
- [ ] جعل بيانات مقدم الطلب تظهر تلقائياً من بيانات التسجيل


## إصلاح الأخطاء
- [x] إصلاح رسالة "المسجد غير موجود" عند تقديم طلب بنيان (لا يتطلب مسجد)
- [x] إصلاح خطأ 404 عند التوجيه بعد إرسال الطلب (/requester/requests/1)


## المرحلة 15: رفع المرفقات ولوحة طالب الخدمة وإدارة المشاريع

### رفع المرفقات
- [x] إنشاء API لرفع الملفات إلى S3
- [x] إضافة مكون رفع الملفات في نموذج الطلب
- [x] دعم رفع صور الموقع
- [x] دعم رفع صكوك الأرض والمستندات
- [x] عرض المرفقات في صفحة تفاصيل الطلب
- [x] إمكانية تحميل المرفقات

### لوحة تحكم طالب الخدمة
- [x] صفحة متابعة الطلبات الخاصة بالمستخدم
- [x] عرض حالة كل طلب مع المرحلة الحالية
- [ ] إشعارات التحديثات على الطلبات
- [ ] إمكانية إضافة تعليقات على الطلب
- [ ] عرض سجل الطلب الكامل

### نظا### نظام إدارة المشاريع
- [x] إنشاء مشروع من طلب معتمد
- [x] إدارة جداول الكميات (BOQ)
- [x] إدارة عروض الأسعار
- [x] إدارة العقود
- [x] إدارة الدفعات المالية
- [x] متابعة مراحل المشروعبط فرص التبرع بالمشاريع


## المرحلة 16: نظام العقود المتكامل

### إعدادات الجمعية (البيانات الثابتة)
- [x] جدول إعدادات الجمعية في قاعدة البيانات
- [x] صفحة إعدادات الجمعية (اسم الجمعية، رقم الترخيص، العنوان، مفوض التوقيع)
- [x] حفظ بيانات الطرف الأول (الجمعية) الثابتة

### نموذج العقد
- [x] جدول العقود في قاعدة البيانات
- [x] ترقيم آلي للعقود
- [x] نموذج إنشاء عقد جديد مع المتغيرات
- [x] أنواع العقود (إشراف هندسي، مقاولات، توريد)
- [x] جدول الدفعات المرتبط بالعقد

### معاينة وطباعة العقد
- [x] صفحة معاينة العقد قبل الطباعة
- [x] تصميم العقد بتنسيق احترافي
- [x] إمكانية طباعة العقد أو تصديره PDF

### تحويل العقد إلى مشروع
- [x] خاصية تحويل العقد المعتمد إلى مشروع
- [x] ربط العقد بالمشروع والطلب


## المرحلة 17: نظام الموردين المعتمدين

### قاعدة بيانات الموردين
- [x] تحديث جدول الموردين بالحقول الجديدة (معلومات الكيان، التواصل، البنك، المرفقات)
- [x] إضافة جدول مجالات العمل للموردين
- [x] إضافة جدول مرفقات الموردين

### نموذج تسجيل الموردين
- [x] الخطوة 1: معلومات الكيان (الاسم، النوع، السجل، النشاط، الخبرة، المجالات)
- [x] الخطوة 2: معلومات التواصل (العنوان، الموقع، البريد، الهاتف، مسؤول التواصل)
- [x] الخطوة 3: معلومات الحساب البنكي (اسم الحساب، البنك، الآيبان، الرقم الضريبي)
- [x] الخطوة 4: المرفقات (السجل التجاري، شهادة الضريبة، العنوان الوطني)

### إدارة واعتماد الموردين
- [x] صفحة قائمة الموردين مع التصفية والبحث
- [x] صفحة تفاصيل المورد
- [x] خاصية اعتماد/رفض المورد
- [x] عرض المرفقات والتحقق منها

### تكامل العقود مع الموردين
- [x] اختيار المورد المعتمد عند إنشاء العقد
- [x] تعبئة بيانات الطرف الثاني تلقائياً من بيانات المورد


## المرحلة 18: إكمال رحلة الطلب

### تحسين نموذج طلب الخدمة
- [ ] جعل بيانات مقدم الطلب تظهر تلقائياً من بيانات التسجيل (غير قابلة للتعديل)
- [ ] إضافة التنبيهات والشروط والأحكام في بداية النموذج
- [ ] تحسين عرض البيانات في صفحة المراجعة

### نموذج المعاينة الميدانية

- [x] إنشاء نموذج المعاينة الميدانية الجديد
- [x] استيراد بيانات الطلب والمسجد تلقائياً
- [x] حقول التقييم الفني (حالة المسجد، المساحات)
- [x] حقول مصلى الرجال (الطول، العرض، الارتفاع)
- [x] حقول مصلى النساء (الطول، العرض، الارتفاع)
- [x] حقل الاحتياج والوصف العام
- [x] رفع صور المعاينة (متعددة)
- [x] حقول فريق المعاينة (5 أعضاء)
### تقرير الاستجابة السريعة
- [x] إنشاء تقرير الاستجابة السريعة الجديد
- [x] استيراد بيانات الطلب والمسجد تلقائياً
- [x] حقول التقييم الفني والنهائي
- [x] حقل الأعمال غير المنفذة وأسباب عدم التنفيذ
- [x] رفع صور التوثيق (حتى 10 صور)
- [x] حقل الفني المختص

### ربط المراحل بالنماذج
- [x] ربط مرحلة الزيارة الميدانية بنموذج المعاينة
- [x] ربط مرحلة الاستجابة السريعة بتقرير الاستجابة
- [x] تحديث صفحة تفاصيل الطلب لعرض التقارير المرتبطة


## المرحلة 19: توحيد أسماء المراحل وإصلاح رحلة الطلب

### توحيد أسماء المراحل
- [x] توحيد أسماء المراحل بين Frontend و Backend
- [x] تحديث STAGE_LABELS في shared/constants.ts
- [x] تحديث stageSteps في RequestDetails.tsx
- [x] تحديث stageSteps في MyRequests.tsx
- [x] المراحل الموحدة: submitted, initial_review, field_visit, technical_eval, financial_eval, execution, closed

### اختبار رحلة الطلب
- [x] اختبار تحويل الطلب من مرحلة تقديم الطلب إلى الفرز الأولي
- [x] اختبار تحويل الطلب من مرحلة الفرز الأولي إلى الزيارة الميدانية
- [x] التأكد من عمل شريط المراحل بشكل صحيح
- [x] التأكد من تسجيل التحديثات في سجل الطلب


## المرحلة 20: نظام صلاحيات المراحل

### تحديد صلاحيات كل مرحلة
- [x] تقديم الطلب (submitted) → الفرز الأولي: مكتب المشاريع، المدير العام، مدير النظام
- [x] الفرز الأولي (initial_review) → الزيارة الميدانية: مكتب المشاريع، المدير العام، مدير النظام
- [x] الزيارة الميدانية (field_visit) → الدراسة الفنية: الفريق الميداني، مكتب المشاريع، المدير العام، مدير النظام
- [x] الدراسة الفنية (technical_eval) → الاعتماد المالي: مكتب المشاريع، المدير العام، مدير النظام
- [x] الاعتماد المالي (financial_eval) → التنفيذ: الإدارة المالية، المدير العام، مدير النظام
- [x] التنفيذ (execution) → الإغلاق: مكتب المشاريع، المدير العام، مدير النظام

### تحديث Backend
- [x] إنشاء ثوابت صلاحيات المراحل في shared/constants.ts
- [x] تحديث updateStage في requests router للتحقق من الصلاحيات
- [x] إرجاع رسالة خطأ واضحة عند عدم وجود صلاحية

### تحديث Frontend
- [x] إظهار/إخفاء زر تحويل المرحلة حسب صلاحية المستخدم
- [x] عرض رسالة توضيحية عند عدم وجود صلاحية
- [x] تحديث صفحة تفاصيل الطلب

### الاختبار
- [x] اختبار صلاحيات كل دور (18 اختبار)
- [x] التأكد من عمل النظام بشكل صحيح (93 اختبار إجمالي)

## المرحلة 21: تحديث رحلة الطلب الكاملة - الخيارات الأربعة للتقييم الفني

## المرحلة 22: إدارة التصنيفات وإضافة زر إضافة مورد

## المرحلة 23: إعادة تصميم نظام التصنيفات والموردين

### إعادة تصميم نظام التصنيفات العام
- [x] إنشاء router للتصنيفات
- [x] إنشاء صفحة إدارة التصنيفات العامة
- [x] واجهة جدول بسيطة بدلاً من التبويبات
- [x] إمكانية إضافة تصنيفات جديدة ديناميكياً
- [x] دعم التصنيفات المختلفة
- [x] نظام البحث والفلترة

### إعادة بناء نموذج تسجيل الموردين
- [x] الصفحة 1: معلومات الكيان
- [x] الصفحة 2: معلومات التواصل
- [x] الصفحة 3: معلومات البنك
- [x] الصفحة 4: المرفقات
- [x] نظام الاعتماد

### إنشاء صفحة إدارة التصنيفات
- [x] إنشاء صفحة CategoriesManagement.tsx
- [x] إضافة تبويب الوحدات
- [x] إضافة تبويب الفئات
- [x] إضافة تبويب البنود
- [x] إضافة عمليات CRUD لكل تصنيف
- [x] إضافة جداول لعرض التصنيفات
- [x] إضافة نماذج Dialog

### إضافة زر إضافة مورد
- [x] إضافة Dialog في SuppliersManagement.tsx
- [x] إضافة حقول النموذج
- [x] إضافة زر الإضافة

### تحديث الشريط الجانبي
- [x] إضافة رابط إدارة التصنيفات

### تحديث التوجيه
- [x] إضافة import ورابط /categories

### تحليل رحلة الطلب من الجدول المرفق
- [x] فهم المراحل الرئيسية: تسجيل الدخول، طلب الخدمة، التقييم الأولي، الدراسة الفنية، التقييم الفني، التقييم المالي، التنفيذ، الإغلاق
- [x] فهم الخيارات الأربعة في مرحلة التقييم الفني:
  1. الاعتذار عن الطلب (مع ذكر المبررات)
  2. تعليق الطلب (مع ذكر المبررات)
  3. التحويل إلى الاستجابة السريعة (زيارة + تقرير استجابة سريعة)
  4. التحويل إلى مشروع

### تحديث Backend
- [x] إضافة ثوابت الخيارات الأربعة في shared/constants.ts (TECHNICAL_EVAL_OPTIONS)
- [x] إضافة endpoint للتقييم الفني technicalEvalDecision
- [x] إضافة حقول جديدة للطلب: requestTrack, technicalEvalDecision, technicalEvalJustification

### مرحلة التقييم الفني (الخيارات الأربعة)
- [x] إضافة زر "الاعتذار عن الطلب" مع نموذج لذكر المبررات (ينتقل للإغلاق)
- [x] إضافة زر "تعليق الطلب" مع نموذج لذكر المبررات (يبقى في نفس المرحلة)
- [x] إضافة زر "التحويل إلى الاستجابة السريعة" (ينتقل للتنفيذ مباشرة)
- [x] إضافة زر "التحويل إلى مشروع" (ينتقل للتقييم المالي)

### تحديث Frontend
- [x] تحديث صفحة تفاصيل الطلب لعرض الخيارات الأربعة في مرحلة التقييم الفني
- [x] إضافة Dialog لكل خيار مع حقل المبررات
- [x] إخفاء زر "تحويل للمرحلة التالية" في مرحلة التقييم الفني

### الاختبار
- [x] إنشاء 21 اختبار للخيارات الأربعة (technical-eval.test.ts)
- [x] اختبار التحويل إلى مشروع من الواجهة
- [x] جميع الاختبارات ناجحة (114 اختبار)

### مرحلة التقييم المالي (للتطوير المستقبلي)
- [ ] إعداد جدول الكميات (BOQ) - موجود
- [ ] طلب عروض الأسعار
- [ ] استقبال العروض وترشيح المورد/الموردين
- [ ] تحديد تكلفة المشروع + نسبة الإشراف

### مرحلة التنفيذ (للتطوير المستقبلي)
- [ ] إعداد عقد المشروع
- [ ] إبرام العقد مع المورد/الموردين
- [ ] طلب صرف دفعة مالية
- [ ] متابعة التنفيذ حسب المراحل

### مرحلة الإغلاق (للتطوير المستقبلي)
- [ ] التقرير الختامي
- [ ] قياس رضا أصحاب المصلحة
- [ ] قياس رضا المستفيد
- [ ] إغلاق عمليات المشروع وصرف الدفعة الختامية


## المرحلة 22: تحسين سير العمل وتجربة المستخدم

### 1. الشروط المسبقة (Prerequisites) للانتقال بين المراحل
- [x] تعريف الشروط المسبقة لكل مرحلة في shared/constants.ts
- [x] الزيارة الميدانية → التقييم الفني: يجب وجود تقرير المعاينة الميدانية
- [x] التقييم الفني → التقييم المالي (مسار المشروع): يجب اختيار "التحويل إلى مشروع"
- [x] التقييم الفني → التنفيذ (مسار الاستجابة السريعة): يجب اختيار "التحويل إلى الاستجابة السريعة"
- [x] التنفيذ → الإغلاق (مسار الاستجابة السريعة): يجب وجود تقرير الاستجابة السريعة
- [x] التنفيذ → الإغلاق (مسار المشروع): يجب وجود عقد معتمد ودفعات مكتملة
- [x] تحديث Backend للتحقق من الشروط قبل الانتقال
- [ ] عرض رسائل توضيحية للمستخدم عند عدم استيفاء الشروط

### 2. تحسين واجهة أزرار التقييم الفني
- [x] تجميع الأزرار الأربعة في قسم واضح ومميز مع عنوان ووصف
- [x] إضافة أيقونات وألوان مميزة لكل خيار (أخضر/بنفسجي/أصفر/أحمر)
- [x] إضافة وصف مختصر لكل خيار يوضح متى يستخدم
- [x] تحسين تصميم الأزرار بشكل بطاقات تفاعلية
- [ ] تحسين تصميم Dialog التأكيد

### 3. تفعيل خطوات التقييم المالي
- [x] إضافة تبويب "التقييم المالي" في صفحة تفاصيل الطلب
- [x] واجهة إعداد جدول الكميات (BOQ) - هيكل أساسي
- [x] واجهة طلب عروض الأسعار - هيكل أساسي
- [x] ملخص التكلفة (تكلفة المواد + العمالة + نسبة الإشراف)
- [ ] ربط الواجهة ببيانات حقيقية من قاعدة البيانات

### 4. نماذج التقارير
- [x] ربط تقرير الاستجابة السريعة بمسار الاستجابة السريعة (يظهر فقط في مرحلة التنفيذ)
- [x] إضافة رسالة توضيحية لمسار الاستجابة السريعة
- [ ] إنشاء نموذج التقرير الختامي لمرحلة الإغلاق
- [ ] قياس رضا المستفيد
- [ ] قياس رضا أصحاب المصلحة

### 5. إشعارات المسارات التلقائية
- [x] إشعار فريق الاستجابة السريعة عند تحويل طلب لمسار الاستجابة السريعة
- [x] إشعار مكتب المشاريع والإدارة المالية عند تحويل طلب لمسار المشروع
- [x] إشعار طالب الخدمة عند تغيير حالة طلبه (موجود مسبقاً)



## المرحلة 23: نظام التقييم المالي المتكامل

### 1. صفحة إدارة جداول الكميات (BOQ)
- [ ] إنشاء صفحة قائمة جداول الكميات /boq
- [ ] عرض جميع جداول الكميات مع الطلب المرتبط
- [ ] إضافة/تعديل/حذف بنود جدول الكميات
- [ ] حساب الإجمالي التلقائي

### 2. صفحة إدارة الموردين
- [ ] إنشاء صفحة قائمة الموردين /suppliers
- [ ] إضافة/تعديل/حذف موردين
- [ ] تصنيف الموردين حسب التخصص
- [ ] عرض تقييم الموردين

### 3. صفحة طلب عروض الأسعار
- [ ] إنشاء صفحة طلب عروض الأسعار /quotations
- [ ] إرسال طلب عرض سعر لموردين محددين
- [ ] استقبال وتسجيل العروض المقدمة
- [ ] مقارنة العروض

### 4. صفحة الاعتماد المالي النهائي
- [ ] إنشاء صفحة الاعتماد المالي /financial-approval
- [ ] عرض السعر المرشح
- [ ] إضافة نسبة الإشراف
- [ ] حساب التكلفة النهائية
- [ ] زر الاعتماد النهائي

### 5. إضافة القوائم في الشريط الجانبي
- [ ] إضافة قائمة "التقييم المالي" في الشريط الجانبي
- [ ] روابط فرعية: جداول الكميات، الموردين، عروض الأسعار، الاعتماد المالي



## المرحلة 24: إصلاح جدول الكميات وإضافة نظام التصنيفات

### 1. إصلاح خطأ الإدراج في جدول الكميات
- [ ] إصلاح خطأ حقل `category` المفقود في عملية الإدراج
- [ ] التأكد من أن جميع الحقول المطلوبة موجودة

### 2. إنشاء نظام التصنيفات
- [ ] إنشاء جدول `units` (الوحدات: متر، كيلو، عدد، إلخ)
- [ ] إنشاء جدول `itemCategories` (تصنيفات البنود: مواد، عمالة، معدات)
- [ ] إنشاء جدول `boqCategories` (تصنيفات الفئات: بناء، كهرباء، سباكة)
- [ ] إضافة صفحة إدارة التصنيفات
- [ ] ربط التصنيفات بجدول الكميات

### 3. إضافة نظام ترقيم جداول الكميات
- [ ] إضافة حقل `boqCode` (مثل BOQ-2025-001)
- [ ] إضافة حقل `boqName` (مسمى وصفي للجدول)
- [ ] إنشاء دالة لتوليد الرقم التلقائي
- [ ] تحديث صفحة BOQ لعرض الرقم والمسمى

### 4. توضيح بند السعر الاستشاري
- [ ] إضافة ملاحظة توضح أن بند السعر الموجود استرشادي فقط
- [ ] عدم إرسال هذا البند للمورد عند طلب العرض


## المرحلة 25: إدارة التصنيفات والموردين

### 1. إنشاء صفحة إدارة التصنيفات
- [ ] إنشاء صفحة Categories.tsx
- [ ] إضافة تبويبات للوحدات والفئات والبنود
- [ ] إضافة واجهة لإضافة وتعديل وحذف التصنيفات

### 2. إضافة زر إضافة مورد
- [ ] إضافة زر "إضافة مورد" في صفحة الموردين
- [ ] إضافة Dialog لإدخال بيانات المورد الجديد

### 3. إضافة الروابط في الشريط الجانبي
- [ ] إضافة رابط "التصنيفات" في القائمة الجانبية
- [ ] تنظيم القوائم بشكل منطقي


## المرحلة 23: إعادة تصميم نظام التصنيفات والموردين

### إعادة تصميم نظام التصنيفات العام
- [ ] إنشاء جدول التصنيفات العام (categories_master)
- [ ] إنشاء صفحة إدارة التصنيفات العامة
- [ ] واجهة جدول بسيطة بدلاً من التبويبات
- [ ] إمكانية إضافة تصنيفات جديدة ديناميكياً
- [ ] دعم التصنيفات المختلفة (مدن، جنسيات، مجالات عمل، وحدات، فئات، بنود)
- [ ] نظام البحث والفلترة




## المرحلة 24: إعادة بناء نموذج تسجيل الموردين في صفحة واحدة

### نموذج صفحة واحدة للموردين
- [x] قسم معلومات الكيان (اسم، نوع، سجل تجاري، نشاط، خبرة، مجالات عمل)
- [x] قسم معلومات التواصل (عنوان، خريطة Google، بريد، هاتف، مسؤول، وظيفة)
- [x] قسم معلومات البنك (حساب، بنك، IBAN، رقم ضريبي)
- [x] قسم المرفقات (سجل تجاري، شهادة ضريبية، عنوان وطني)
- [x] قسم بيانات الاعتماد (حالة، تاريخ، ملاحظات)


## المرحلة 25: تحديث صفحة إدارة الموردين

### تحديث نموذج إضافة مورد في صفحة الإدارة
- [x] تحديث Dialog إضافة مورد ليعرض ملخص الأقسام المطلوبة
- [x] إضافة قسم معلومات الكيان
- [x] إضافة قسم معلومات التواصل
- [x] إضافة قسم معلومات البنك
- [x] إضافة قسم المرفقات
- [x] ربط الزر بصفحة التسجيل الكاملة


## المرحلة 26: إصلاح خطأ عرض بيانات Base64

- [ ] إصلاح عرض بيانات Base64 في صفحة تسجيل الموردين
- [ ] إخفاء البيانات الخام وعرض اسم الملف فقط


## المرحلة 26: إصلاح خطأ عرض بيانات Base64

- [x] إصلاح عرض بيانات Base64 في صفحة تسجيل الموردين
- [x] تنظيف رسائل الخطأ من بيانات Base64 عند الإرسال
- [x] إصلاح خطأ useState المكرر في CategoriesManagement.tsx


## المرحلة 27: إصلاح خطأ تسجيل المورد

- [x] فحص سبب خطأ التسجيل في Backend (حقول المرفقات كانت varchar(500) وبيانات Base64 أطول)
- [x] تغيير نوع حقول المرفقات إلى mediumtext لتخزين بيانات Base64
- [x] تطبيق التغييرات على قاعدة البيانات


## المرحلة 28: توسيط صفحة تسجيل الدخول

- [x] توسيط صفحة تسجيل الدخول في منتصف الشاشة
- [x] إزالة الجانب الأيمن (الصورة) لتوسيط النموذج


## المرحلة 29: إصلاح خطأ إضافة بند جدول الكميات

- [x] فحص سبب خطأ الإدراج (projectId كان يستخدم requestId بشكل خاطئ)
- [x] تعديل router addBOQItem ليجلب أو ينشئ projectId تلقائياً
- [x] تعديل صفحة BOQ.tsx لإرسال requestId فقط
- [x] تعديل ProjectDetailsPage.tsx لإضافة requestId


## المرحلة 30: إعادة تصميم صفحة إدارة التصنيفات

- [ ] إعادة تصميم الصفحة لتعرض قائمة التصنيفات الرئيسية
- [ ] إضافة صفحة تفاصيل لكل تصنيف
- [ ] إضافة زر إضافة تصنيف جديد
- [ ] تنظيم العرض بشكل أفضل


## المرحلة 31: إصلاح مشكلة جدول الكميات

- [x] فحص سبب عدم ظهور البنود (getBOQ كان يبحث بـ projectId بدلاً من requestId)
- [x] تعديل getBOQ ليقبل requestId
- [x] تعديل صفحة BOQ.tsx لإرسال requestId
- [x] البنود تظهر الآن بشكل صحيح



## المرحلة 32: إصلاح منطق التقييم المالي وعروض الأسعار

- [x] إصلاح خطأ إضافة عرض السعر (projectId مفقود في الاستعلام)
- [x] ربط عروض الأسعار بجدول الكميات وإظهار البنود
- [x] إصلاح شروط التحقق من جدول الكميات في مرحلة التقييم المالي
- [x] ضبط التسلسل المنطقي: جدول كميات → عروض أسعار → اعتماد مالي
- [x] اختبار التسلسل الكامل


## المرحلة 33: تحسين نظام عروض الأسعار

- [x] إصلاح جلب الموردين لإظهار الشركات الجديدة في قائمة الاختيار (مع خيار إظهار غير المعتمدين)
- [x] تعديل نموذج عرض السعر لإظهار بنود جدول الكميات
- [x] تمكين تسعير كل بند على حدة مع حساب الإجمالي تلقائياً
- [x] تخزين تفاصيل البنود في حقل items بجدول quotations (JSON)
- [x] ربط عروض الأسعار بالتقييم المالي بشكل صحيح
- [x] اختبار التعديلات


## المرحلة 35: إضافة إمكانية إلغاء اعتماد العرض

- [x] إضافة زر "إلغاء الاعتماد" للعروض المعتمدة
- [x] إضافة زر "إعادة للمراجعة" للعروض المرفوضة
- [x] اختبار التعديلات


## المرحلة 36: نافذة اعتماد متقدمة مع تعديل المبلغ

- [x] إضافة نافذة Dialog للاعتماد مع حقل المبلغ المعتمد
- [x] إضافة حقل المبرر/الملاحظات (مثال: تم التفاوض مع المورد)
- [x] تعديل backend لحفظ المبلغ المعتمد والمبرر
- [x] إظهار رسالة تنبيه عند تعديل المبلغ عن الأصلي
- [x] اختبار التعديلات

**ملاحظة**: النظام يسمح باعتماد أكثر من عرض لنفس الطلب - يمكن تعديله لاحقاً إذا لزم الأمر


## المرحلة 37: ربط شاشات الطلبات وعروض الأسعار والاعتماد المالي

- [x] تحليل تدفق البيانات الحالي بين الشاشات الثلاث
- [x] ربط صفحة تفاصيل الطلب بعروض الأسعار (عرض العروض المقدمة للطلب)
- [x] ربط صفحة تفاصيل الطلب بالاعتماد المالي (عرض حالة الاعتماد)
- [x] ربط صفحة عروض الأسعار بتفاصيل الطلب (رابط للطلب المرتبط)
- [x] ربط صفحة الاعتماد المالي بعروض الأسعار المعتمدة
- [x] إضافة روابط تنقل سريعة بين الشاشات المترابطة
- [x] إضافة أزرار اعتماد/رفض عروض الأسعار في صفحة تفاصيل الطلب
- [x] إضافة نافذة اعتماد متقدمة مع إمكانية تعديل المبلغ
- [x] اختبار التكامل والترابط


## المرحلة 38: تحسينات التفاوض وسجل الطلب والانتقال بين المراحل

### خيار تعديل السعر للتفاوض
- [ ] إضافة نافذة تعديل السعر للتفاوض مع حقل المبررات
- [ ] عرض السعر الأصلي والسعر المعدل بشكل واضح
- [ ] حفظ سجل التفاوض والمبررات في قاعدة البيانات
- [ ] عرض تاريخ التفاوض في تفاصيل العرض

### تعريب سجل الطلب
- [ ] تعريب جميع عناوين سجل الطلب (Request History)
- [ ] تعريب أنواع الأحداث في السجل
- [ ] تعريب التواريخ والأوقات

### إصلاح الانتقال للمرحلة التالية
- [ ] إصلاح الانتقال من الاعتماد المالي إلى التعاقد/التنفيذ
- [ ] إضافة مرحلة التفاوض قبل التعاقد (اختياري)
- [ ] التأكد من تسلسل المراحل بشكل صحيح


## المرحلة 39: نظام قوالب العقود المتقدم

### 1. قاعدة البيانات
- [ ] إنشاء جدول قوالب العقود (contract_templates)
- [ ] إنشاء جدول بنود العقود (contract_clauses)
- [ ] إنشاء جدول قيم البنود في العقود (contract_clause_values)
- [ ] تحديث جدول العقود لربطه بالقوالب
- [ ] إنشاء جدول إعدادات الجمعية المحدث (المفوضين)
- [ ] تشغيل db:push

### 2. Backend APIs
- [ ] إنشاء router لقوالب العقود
- [ ] CRUD للقوالب (إنشاء، قراءة، تعديل، حذف)
- [ ] CRUD للبنود
- [ ] نسخ قالب
- [ ] جلب القوالب النشطة

### 3. صفحة إدارة قوالب العقود
- [ ] قائمة القوالب مع البحث والفلترة
- [ ] نموذج إنشاء قالب جديد
- [ ] محرر البنود (إضافة، تعديل، حذف، ترتيب)
- [ ] مكتبة البنود الجاهزة
- [ ] معاينة القالب

### 4. صفحة إنشاء العقد
- [ ] اختيار القالب من القوالب المتاحة
- [ ] تعبئة بيانات الأطراف تلقائياً
- [ ] تخصيص البنود (تعديل/إضافة/حذف)
- [ ] جدول الدفعات القابل للتخصيص
- [ ] حفظ العقد

### 5. صفحة معاينة وطباعة العقد
- [ ] عرض العقد بتنسيق احترافي
- [ ] الترويسة مع الشعارات
- [ ] بيانات الأطراف
- [ ] البنود المخصصة
- [ ] جدول الدفعات
- [ ] قسم التوقيعات
- [ ] تصدير PDF
- [ ] طباعة مباشرة

### 6. مرحلة التنفيذ
- [ ] ربط العقد بالمشروع
- [ ] إدارة الدفعات (طلب صرف، اعتماد، صرف)
- [ ] متابعة حالة الدفعات
- [ ] تقارير الدفعات

### 7. مرحلة الإغلاق
- [ ] نموذج التقرير الختامي
- [ ] قياس رضا المستفيد
- [ ] إغلاق المشروع
- [ ] أرشفة الملفات



## المرحلة 28: نظام إنشاء العقود المتقدم

### قوالب العقود
- [x] إنشاء جدول قوالب العقود (contractTemplates)
- [x] إنشاء جدول بنود العقود (contractClauses)
- [x] إنشاء جدول قيم البنود المخصصة (contractClauseValues)
- [x] API للحصول على قوالب العقود
- [x] API للحصول على بنود قالب معين

### نموذج إنشاء العقد المتقدم
- [x] خطوة اختيار القالب
- [x] خطوة اختيار الطرف الثاني (المورد)
- [x] خطوة تفاصيل العقد (الموضوع، المدة، القيمة)
- [x] خطوة جدول الدفعات (إضافة/حذف/تعديل الدفعات)
- [x] خطوة تخصيص البنود (تضمين/استبعاد/تعديل)
- [x] خطوة المراجعة النهائية

### حفظ بيانات العقد
- [x] حفظ templateId في العقد
- [x] حفظ paymentScheduleJson في العقد
- [x] حفظ clauseValuesJson في العقد
- [x] إنشاء سجلات الدفعات من جدول الدفعات
- [x] إنشاء سجلات قيم البنود المخصصة

### ربط العقود بالطلبات
- [x] إضافة رابط إنشاء عقد من الطلب (/contracts/new/request/:requestId)
- [x] زر إنشاء عقد في صفحة تفاصيل الطلب (عند وجود عرض سعر معتمد)
- [x] تعبئة بيانات المورد والقيمة تلقائياً من العرض المعتمد



## المرحلة 29: خاصية تكرار العقود (Duplicate)

### Backend
- [x] إضافة mutation لتكرار العقد (duplicate)
- [x] نسخ جميع بيانات العقد الأصلي
- [x] إضافة كلمة "نسخة" لعنوان العقد المكرر
- [x] توليد رقم عقد جديد للنسخة
- [x] نسخ جدول الدفعات
- [x] نسخ بنود العقد المخصصة

### Frontend
- [x] إضافة زر التكرار في قائمة العقود (صفحة تفاصيل المشروع)
- [x] إضافة زر التكرار في صفحة معاينة العقد
- [x] عرض رسالة نجاح والتوجيه للعقد الجديد


## المرحلة 30: إصلاح تعبئة بيانات الطلب تلقائياً في نموذج العقد

- [x] تعبئة المشروع المرتبط بالطلب تلقائياً
- [x] إخفاء قائمة اختيار المشروع عند وجود requestId وعرض المشروع كقيمة ثابتة
- [x] تعبئة بيانات المورد من عرض السعر المعتمد
- [x] تعبئة قيمة العقد من عرض السعر المعتمد


## المرحلة 31: نظام إدارة العقود الشامل

### صفحة قائمة العقود
- [x] إنشاء صفحة قائمة العقود المبرمة
- [x] إضافة فلترة حسب الحالة والنوع
- [x] إضافة بحث برقم العقد أو اسم المورد
- [x] إضافة أزرار استعراض وطباعة وتكرار لكل عقد
- [x] نقل قوالب العقود لتكون ضمن قائمة العقود (تبويبات)

### نظام اعتماد العقد
- [x] حالات العقد موجودة (مسودة، قيد الاعتماد، معتمد، ساري، مكتمل، ملغي)
- [x] زر اعتماد العقد موجود
- [x] إضافة علامة "معتمد" على العقد المعتمد

### نظام التعديل بموافقة
- [x] إنشاء جدول طلبات تعديل العقود
- [x] إنشاء جدول سجل تعديلات العقود
- [x] إضافة APIs لطلب التعديل والموافقة والرفض
- [x] منع التعديل للعقود التي صُرفت لها دفعات
- [x] العقود المعتمدة تحتاج موافقة للتعديل


## المرحلة 32: إصلاحات نظام العقود

### تقييد تواريخ الدفعات
- [x] تقييد تواريخ الدفعات لتكون ضمن فترة العقد (من تاريخ البدء حتى انتهاء المدة)
- [x] منع اختيار تاريخ خارج الإطار الزمني للعقد (مع رسالة توضيحية)

### تعبئة قيمة العقد
- [x] تعبئة قيمة العقد من المبلغ المعتمد (approvedAmount) بدلاً من المبلغ الأصلي
- [x] عرض المبلغ المعتمد بعد التفاوض

### سجل التاريخ
- [x] إضافة سجل في التاريخ عند إنشاء عقد جديد
- [x] ربط العقد بالطلب في السجل الزمني
