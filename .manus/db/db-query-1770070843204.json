{
  "query": "\nCREATE TABLE IF NOT EXISTS modules (\n  id VARCHAR(50) PRIMARY KEY,\n  name_ar VARCHAR(100) NOT NULL,\n  name_en VARCHAR(100) NOT NULL,\n  description TEXT,\n  icon VARCHAR(50),\n  display_order INT,\n  is_active BOOLEAN DEFAULT TRUE NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n\nCREATE TABLE IF NOT EXISTS permissions (\n  id VARCHAR(100) PRIMARY KEY,\n  module_id VARCHAR(50) NOT NULL,\n  action VARCHAR(50) NOT NULL,\n  name_ar VARCHAR(100) NOT NULL,\n  name_en VARCHAR(100) NOT NULL,\n  description TEXT,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  FOREIGN KEY (module_id) REFERENCES modules(id)\n);\n\nCREATE TABLE IF NOT EXISTS roles (\n  id VARCHAR(50) PRIMARY KEY,\n  name_ar VARCHAR(100) NOT NULL,\n  name_en VARCHAR(100) NOT NULL,\n  description TEXT,\n  is_system BOOLEAN DEFAULT FALSE NOT NULL,\n  is_active BOOLEAN DEFAULT TRUE NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\nCREATE TABLE IF NOT EXISTS role_permissions (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  role_id VARCHAR(50) NOT NULL,\n  permission_id VARCHAR(100) NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,\n  FOREIGN KEY (permission_id) REFERENCES permissions(id) ON DELETE CASCADE,\n  UNIQUE KEY unique_role_permission (role_id, permission_id)\n);\n\nCREATE TABLE IF NOT EXISTS user_roles (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  user_id INT NOT NULL,\n  role_id VARCHAR(50) NOT NULL,\n  assigned_by INT,\n  assigned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  expires_at TIMESTAMP NULL,\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,\n  FOREIGN KEY (assigned_by) REFERENCES users(id),\n  UNIQUE KEY unique_user_role (user_id, role_id)\n);\n\nCREATE TABLE IF NOT EXISTS user_permissions (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  user_id INT NOT NULL,\n  permission_id VARCHAR(100) NOT NULL,\n  granted BOOLEAN NOT NULL,\n  granted_by INT NOT NULL,\n  reason TEXT,\n  expires_at TIMESTAMP NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (permission_id) REFERENCES permissions(id) ON DELETE CASCADE,\n  FOREIGN KEY (granted_by) REFERENCES users(id)\n);\n\nCREATE TABLE IF NOT EXISTS permissions_audit_log (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  action_type VARCHAR(50) NOT NULL,\n  target_user_id INT NOT NULL,\n  target_role_id VARCHAR(50),\n  permission_id VARCHAR(100),\n  performed_by INT NOT NULL,\n  reason TEXT,\n  old_value TEXT,\n  new_value TEXT,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  FOREIGN KEY (target_user_id) REFERENCES users(id),\n  FOREIGN KEY (target_role_id) REFERENCES roles(id),\n  FOREIGN KEY (permission_id) REFERENCES permissions(id),\n  FOREIGN KEY (performed_by) REFERENCES users(id)\n);\n",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 47svcMedBpAqYJW.4862cbe35d00 --database 6TUn3HPSK4hJ6Fxv2aR83j --execute \nCREATE TABLE IF NOT EXISTS modules (\n  id VARCHAR(50) PRIMARY KEY,\n  name_ar VARCHAR(100) NOT NULL,\n  name_en VARCHAR(100) NOT NULL,\n  description TEXT,\n  icon VARCHAR(50),\n  display_order INT,\n  is_active BOOLEAN DEFAULT TRUE NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL\n);\n\nCREATE TABLE IF NOT EXISTS permissions (\n  id VARCHAR(100) PRIMARY KEY,\n  module_id VARCHAR(50) NOT NULL,\n  action VARCHAR(50) NOT NULL,\n  name_ar VARCHAR(100) NOT NULL,\n  name_en VARCHAR(100) NOT NULL,\n  description TEXT,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  FOREIGN KEY (module_id) REFERENCES modules(id)\n);\n\nCREATE TABLE IF NOT EXISTS roles (\n  id VARCHAR(50) PRIMARY KEY,\n  name_ar VARCHAR(100) NOT NULL,\n  name_en VARCHAR(100) NOT NULL,\n  description TEXT,\n  is_system BOOLEAN DEFAULT FALSE NOT NULL,\n  is_active BOOLEAN DEFAULT TRUE NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP NOT NULL\n);\n\nCREATE TABLE IF NOT EXISTS role_permissions (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  role_id VARCHAR(50) NOT NULL,\n  permission_id VARCHAR(100) NOT NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,\n  FOREIGN KEY (permission_id) REFERENCES permissions(id) ON DELETE CASCADE,\n  UNIQUE KEY unique_role_permission (role_id, permission_id)\n);\n\nCREATE TABLE IF NOT EXISTS user_roles (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  user_id INT NOT NULL,\n  role_id VARCHAR(50) NOT NULL,\n  assigned_by INT,\n  assigned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  expires_at TIMESTAMP NULL,\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (role_id) REFERENCES roles(id) ON DELETE CASCADE,\n  FOREIGN KEY (assigned_by) REFERENCES users(id),\n  UNIQUE KEY unique_user_role (user_id, role_id)\n);\n\nCREATE TABLE IF NOT EXISTS user_permissions (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  user_id INT NOT NULL,\n  permission_id VARCHAR(100) NOT NULL,\n  granted BOOLEAN NOT NULL,\n  granted_by INT NOT NULL,\n  reason TEXT,\n  expires_at TIMESTAMP NULL,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE,\n  FOREIGN KEY (permission_id) REFERENCES permissions(id) ON DELETE CASCADE,\n  FOREIGN KEY (granted_by) REFERENCES users(id)\n);\n\nCREATE TABLE IF NOT EXISTS permissions_audit_log (\n  id INT AUTO_INCREMENT PRIMARY KEY,\n  action_type VARCHAR(50) NOT NULL,\n  target_user_id INT NOT NULL,\n  target_role_id VARCHAR(50),\n  permission_id VARCHAR(100),\n  performed_by INT NOT NULL,\n  reason TEXT,\n  old_value TEXT,\n  new_value TEXT,\n  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP NOT NULL,\n  FOREIGN KEY (target_user_id) REFERENCES users(id),\n  FOREIGN KEY (target_role_id) REFERENCES roles(id),\n  FOREIGN KEY (permission_id) REFERENCES permissions(id),\n  FOREIGN KEY (performed_by) REFERENCES users(id)\n);\n",
  "rows": [],
  "messages": [],
  "stdout": "",
  "stderr": "",
  "execution_time_ms": 4180
}